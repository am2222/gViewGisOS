var xMap=new function(){this.VERSION="0.9";this.N=document.all?!1:!0;this.WebMercatorConfig=this.FocusMap=null;this.IsTouchDevice=!1;this.$=function(a){return document.getElementById(a)};this.Init=function(){xMap.UI.Init()}};try{document.createEvent("TouchEvent"),xMap.IsTouchDevice=!0}catch(e$$8){xMap.IsTouchDevice=!1}
xMap.Globals=new function(){this.Timer=function(a,b){var d=0,e=a,c=b;this.SetDuration=function(b){c=b};this.Duration=function(){return c};this.Start=function(){window.clearTimeout(d);0==c?e():d=window.setTimeout(e,c)};this.StartWith=function(c){e=c;this.Start()};this.Stop=function(){window.clearTimeout(d)}};this.Animation=function(a,b,d,e){var c=b,f=new xMap.Globals.Timer(function(){var b=a(c);!1!=b?(c=b,f.Start()):e(c)},d);this.Start=function(){f.Start()}};this.TraceDebug=function(a){document.getElementById("debug")&&
(document.getElementById("debug").innerHTML+=a+"<br/>")}};
xMap.Geometry=new function(){this.Point=function(a,b){var d=a,e=b;this.X=function(){return d};this.Y=function(){return e};this.SetXY=function(c,b){d=c;e=b};this.Distance=function(c){return Math.sqrt((d-c.X())*(d-c.X())+(e-c.Y())*(e-c.Y()))};this.Type="point"};this.Rectangle=function(a,b,d,e){var c=a,f=b,h=d,j=e;this.Set=function(b,a,e,d){c=b;f=a;h=e;j=d};this.Left=function(){return c};this.Top=function(){return f};this.Width=function(){return h};this.Height=function(){return j};this.Contains=function(b,
a){return b>=c&&b<=parseInt(c+h)&&a>=f&&a<=parseInt(f+j)};this.Intersects=function(b){return b.Left()<=c&&b.Left()+b.Width()>=parseInt(c+h)&&b.Top()<=f&&b.Top()+b.Height()>=parseInt(f+j)?!0:!1}};this.Bounds=function(a){var b=Array(4);b[0]=Math.min(a[0],a[2]);b[1]=Math.min(a[1],a[3]);b[2]=Math.max(a[0],a[2]);b[3]=Math.max(a[1],a[3]);this.xMin=function(){return b[0]};this.yMin=function(){return b[1]};this.xMax=function(){return b[2]};this.yMax=function(){return b[3]};this.Width=function(){return Math.abs(b[2]-
b[0])};this.Height=function(){return Math.abs(b[3]-b[1])};this.CenterPoint=function(){return new xMap.Geometry.Point(0.5*b[0]+0.5*b[2],0.5*b[1]+0.5*b[3])}}};
xMap.Dom=new function(){this.addEventListener=function(a,b,d){a.addEventListener?a.addEventListener(b,d,!1):a.attachEvent&&a.attachEvent("on"+b,d)};removeEventListener=function(a,b,d){a.removeEventListener?a.removeEventListener(b,d,!1):a.detachEvent&&a.detachEvent("on"+b,d)};this.preventDefault=function(a){a.preventDefault?a.preventDefault():a.returnValue=!1};this.cancelEvent=function(a){a=a||window.event;a.stopPropagation&&a.stopPropagation();a.cancelBubble=!0;this.preventDefault(a);return!1};this.getStyleSheet=
function(a){for(var b=0;b<document.styleSheets.length;b++){var d=document.styleSheets[b];if(d.title==a)return d}return null};this.appendStyleSheet=function(a,b){var d=this.getStyleSheet(a);if(!d){var e=document.getElementsByTagName("head")[0],d=document.createElement("style"),c=document.createTextNode(b);d.type="text/css";d.title=a;d.styleSheet?d.styleSheet.cssText=c.nodeValue:d.appendChild(c);e.appendChild(d)}};this.touchScroll=function(a){if(!0==xMap.IsTouchDevice){var b=0;a.style.overflow="hidden";
xMap.Dom.addEventListener(a,"touchstart",function(a){b=this.scrollTop+a.touches[0].pageY;return xMap.Dom.cancelEvent(a)});xMap.Dom.addEventListener(a,"touchmove",function(a){this.scrollTop=b-a.touches[0].pageY;return xMap.Dom.cancelEvent(a)})}};this.addClickListener=function(a,b){if(!0==xMap.IsTouchDevice){a.click=b;var d;xMap.Dom.addEventListener(a,"touchstart",function(b){0<b.touches.length&&((new Date).getTime(),d=b.touches[0].pageY,touchY2=0)});xMap.Dom.addEventListener(a,"touchmove",function(b){0<
b.touches.length&&(touchY2=Math.max(Math.abs(d-b.touches[0].pageY),touchY2))});xMap.Dom.addEventListener(a,"touchend",function(b){0==b.touches.length&&10>touchY2&&this.click()})}else xMap.Dom.addEventListener(a,"click",b)};this.Sender=function(a){return a&&a.target||window.event&&window.event.srcElement}};
xMap.AJAX=function(a){function b(){4==c.readyState&&(h=!1,j&&j(c.responseText))}function d(a){!0==h?(new xMap.Globals.Timer(function(){d(a)},500)).Start():null!=c&&(h=!0,c.open("GET",a,!0),c.onreadystatechange=b,c.send(null))}function e(a,f){!0==h?(new xMap.Globals.Timer(function(){e(a,f)},500)).Start():null!=c&&(h=!0,c.open("POST",a,!0),c.onreadystatechange=b,c.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),c.setRequestHeader("Content-length",f.length),c.send(f))}var c;if(window.XMLHttpRequest)c=
new XMLHttpRequest;else if(window.ActiveXObject)try{c=new ActiveXObject("Microsoft.XMLHTTP")}catch(f){c=new ActiveXObject("Msxml2.XMLHTTP")}var h=!1,j=a;c.onreadystatechange=b;this.HttpRequest=function(){return c};this.readyState=function(){return c.readyState};this.abort=function(){0<c.readyState&&4!=c.readyState&&(c.abort(),h=!1)};this.SendAsynchronGet=d;this.SendAsynchronPost=e};
xMap.SyncAJAX=function(){var a;if(window.XMLHttpRequest)a=new XMLHttpRequest;else if(window.ActiveXObject)try{a=new ActiveXObject("Microsoft.XMLHTTP")}catch(b){a=new ActiveXObject("Msxml2.XMLHTTP")}this.SendSynchronGet=function(b,e){null!=a&&(a.open("GET",b,!1),a.onreadystatechange=function(){},a.send(null),e&&e(a.responseText))}};xMap.GeoDatum=function(a,b,d){this.a=a;this.b=b;this.trafo=d;this.e=function(){return Math.sqrt(1-this.b*this.b/(this.a*this.a))};this.Ell2XYZ=function(b,a,f){var a=a*(Math.PI/180),b=b*(Math.PI/180),d=this.e(),j=this.a/Math.sqrt(1-d*d*Math.pow(Math.sin(a),2));return[(j+f)*Math.cos(a)*Math.cos(b),(j+f)*Math.cos(a)*Math.sin(b),(j*(1-d*d)+f)*Math.sin(a)]};this.XYZ2Ell=function(b,a,f){for(var d=Math.atan(f/Math.sqrt(b*b+a*a)),j=this.e(),g=0;;){var i;i=b;var k=a,o=f,l=d,p=j,n=this.a/Math.sqrt(1-p*p*Math.pow(Math.sin(l),
2)),l=Math.sqrt(i*i+k*k)/Math.cos(l)-n;i=[180*Math.atan(k/i)/Math.PI,180*Math.atan(o/Math.sqrt(i*i+k*k)/(1-n*p*p/(n+l)))/Math.PI,l];if(1.0E-6>Math.abs(i[1]-180*d/Math.PI)||20<g)return i;d=i[1]*Math.PI/180;g++}}};
xMap.HelmertTrafo=new function(){this.trans=function(a,b,d,e){var c=a.rx/3600*Math.PI/180,f=a.ry/3600*Math.PI/180,h=a.rz/3600*Math.PI/180,j=a.s/1E6+1;return[a.tx+b*j-d*h+e*f,a.ty+b*h+d*j-e*c,a.tz-b*f+d*c+e*j]};this.itrans=function(a,b,d,e){return this.trans({tx:-a.tx,ty:-a.ty,tz:-a.tz,rx:-a.rx,ry:-a.ry,rz:-a.rz,s:-a.s},b,d,e)}};
xMap.TMerc=function(){this.proj=function(a,b,d,e,c){var b=b*Math.PI/180,a=a*Math.PI/180,e=e*Math.PI/180,f=d.e(),h=f*f/(1-f*f),j=d.a/Math.pow(1-f*f*Math.sin(b)*Math.sin(b),0.5),g=Math.pow(Math.tan(b),2),i=h*Math.pow(Math.cos(b),2),a=(a-e)*Math.cos(b),d=d.a*((1-f*f/4-3*Math.pow(f,4)/64-5*Math.pow(f,6)/256)*b-(3*f*f/8+3*Math.pow(f,4)/32+45*Math.pow(f,6)/1024)*Math.sin(2*b)+(15*Math.pow(f,4)/256+45*Math.pow(f,6)/1024)*Math.sin(4*b)-35*Math.pow(f,6)/3072*Math.sin(6*b)),k=13*i*i+4*i*i*i-64*i*i*g-24*i*i*
i*g,o=(61-479*g+179*g*g-g*g*g)*Math.pow(a,7)/504,f=445*i*i+324*i*i*i-680*i*i*g+88*i*i*i*i-600*i*i*i*g-192*i*i*i*i*g,e=(1385-3111*g+543*g*g-g*g*g)*Math.pow(a,8)/40320,k=c*j*(a+(1-g+i)*Math.pow(a,3)/6+(5-18*g+g*g+72*i-58*h+k)*Math.pow(a,5)/120+o),b=c*(d+j*Math.tan(b)*(a*a/2+(5-g+9*i+4*i*i)*Math.pow(a,4)/24+(61-58*g+g*g+600*i-330*h+f)*Math.pow(a,6)/720)+e);return new xMap.Geometry.Point(k,b)};this.iproj=function(a,b,d,e,c){var f=d.e();E1=(1-Math.pow(1-f*f,0.5))/(1+Math.pow(1-f*f,0.5));M1=b/c;nu=M1/(d.a*
(1-f*f/4-3*Math.pow(f,4)/64-5*Math.pow(f,6)/256));phi1=nu+(3*E1/2-27*Math.pow(E1,3)/32)*Math.sin(2*nu)+(21*E1*E1/16-55*Math.pow(E1,4)/32)*Math.sin(4*nu)+ +(151*Math.pow(E1,3)/96)*Math.sin(6*nu)+1097*Math.pow(E1,4)/512*Math.sin(8*nu);E=f*f/(1-f*f);C1=E*Math.pow(Math.cos(phi1),2);T1=Math.pow(Math.tan(phi1),2);N1=d.a/Math.pow(1-f*f*Math.pow(Math.sin(phi1),2),0.5);R1=d.a*(1-f*f)/Math.pow(1-f*f*Math.pow(Math.sin(phi1),2),1.5);D=a/(N1*c);d=-90*C1*T1*T1-66*C1*C1*T1+255*C1*C1*T1*T1+100*Math.pow(C1,3)+84*
Math.pow(C1,3)*T1+88*Math.pow(C1,4)-192*Math.pow(C1,4)*T1;c=-(1385+3633*T1+4095*T1*T1+1574*Math.pow(T1,3))*Math.pow(D,8)/40320;a=-4*Math.pow(C1,3)+4*C1*C1*T1+24*Math.pow(C1,3)*T1;b=-(61+662*T1+1320*T1*T1+720*Math.pow(T1,3))*Math.pow(D,7)/5040;d=phi1-N1/R1*Math.tan(phi1)*(D*D/2-(5+3*T1+10*C1-4*C1*C1-9*E)*Math.pow(D,4)/24+(61+90*T1+298*C1+45*T1*T1-252*E-3*C1*C1+d)*Math.pow(D,6)/720+c);a=(D-(1+2*T1+C1)/6*Math.pow(D,3)+(5-2*C1+28*T1-3*C1*C1+8*E+24*T1*T1+a)*Math.pow(D,5)/120+b)/Math.cos(phi1);return new xMap.Geometry.Point(180*
a/Math.PI+e,180*d/Math.PI)}};
xMap.GeoProjection=function(a,b,d,e,c,f){this.fromWGS84=function(h,j){var g=xMap.Proj.DatumWGS84.Ell2XYZ(h,j,0),g=b.trafo?xMap.HelmertTrafo.itrans(b.trafo,g[0],g[1],g[2]):g,g=b.XYZ2Ell(g[0],g[1],g[2]),h=g[0],j=g[1],g=a.proj(h,j,b,d,f);g.SetXY(g.X()+e,g.Y()+c);return g};this.toWGS84=function(h,j){var h=h-e,j=j-c,g=a.iproj(h,j,b,d,f),g=b.Ell2XYZ(g.X(),g.Y(),0),g=b.trafo?xMap.HelmertTrafo.trans(b.trafo,g[0],g[1],g[2]):g,g=xMap.Proj.DatumWGS84.XYZ2Ell(g[0],g[1],g[2]);return new xMap.Geometry.Point(g[0],g[1])}};
xMap.Proj_=function(){var a=[],b=[],d=[];this.SetGeodeticProjection=function(b,a){d[b]=a};this.DatumWGS84=new xMap.GeoDatum(6378137,6356752.3142);this.DatumMGI=new xMap.GeoDatum(6377397.2,6356079,{tx:577.326,ty:90.129,tz:463.919,rx:5.137,ry:1.474,rz:5.297,s:2.4232});a["EPSG:4326"]=function(b,a){return new Point(b,a)};a["EPSG:900913"]=a["EPSG:3857"]=a["EPSG:102113"]=a["EPSG:102100"]=function(b,a){if(2.00375083427892E7<Math.abs(b)||2.00375083427892E7<Math.abs(a))return null;var f=57.29577951308232*
(b/6378137),d=1.5707963267948966-2*Math.atan(Math.exp(-1*a/6378137));return new xMap.Geometry.Point(f,57.29577951308232*d)};b["EPSG:4326"]=new function(b,a){return new xMap.Geometry.Point(b,a)};b["EPSG:900913"]=b["EPSG:3857"]=b["EPSG:102113"]=b["EPSG:102100"]=function(b,a){if(180<Math.abs(b)||90<Math.abs(a))return null;var f=0.017453292519943295*a;return new xMap.Geometry.Point(6378137*0.017453292519943295*b,3189068.5*Math.log((1+Math.sin(f))/(1-Math.sin(f))))};this.ToWGS84=function(b,c,f){return a[b]?
a[b](c,f):d[b]?d[b].toWGS84(c,f):null};this.FromWGS84=function(a,c,f){return b[a]?b[a](c,f):d[a]?d[a].fromWGS84(c,f):null};this.FromWGS84Array=function(a,c){if(c&&0==c.length%2)if(b[a])for(var f=0;f<c.length;f+=2){var h=b[a](c[f],c[f+1]);c[f]=h.X();c[f+1]=h.Y()}else if(d[a])for(f=0;f<c.length;f+=2)h=d[a].fromWGS84(c[f],c[f+1]),c[f]=h.X(),c[f+1]=h.Y();return c}};xMap.Proj=new xMap.Proj_;xMap.Event={};xMap.Event.suppressMouse=!1;xMap.Event.mouse_shiftKey=!1;xMap.Event.mouse_altKey=!1;xMap.Event.mouse_ctrlKey=!1;xMap.Event.mouse_right=!1;xMap.Event.resizeTimer=new xMap.Globals.Timer(function(){},1E3);xMap.Event.OnQueryResultMarkerClick=function(){};
xMap.Events=function(){var a=0;if(!0==(-1!=navigator.appName.indexOf("Microsoft Internet Explorer")?!0:!1))a=-2;var b=null,d=null,e=null,c=null,f=null,h=null,j=null,g=null,i=0,k=function(a){if(!a.touches||!0==xMap.Event.suppressMouse||!0==xMap.UI.xPaneVisible)return!0;if(1==i&&1==a.touches.length&&l)l(a.touches[0]);else if(2==i&&2==a.touches.length&&j){var f=parseInt(a.touches[0].pageX-g.X()),c=parseInt(a.touches[0].pageY-g.Y()),d=parseInt(a.touches[1].pageX-g.X()),e=parseInt(a.touches[1].pageY-g.Y());
j(b,f,c,d,e)}xMap.Dom.preventDefault(a)},o=function(a){if(!a.touches||!0==xMap.Event.suppressMouse||!0==xMap.UI.xPaneVisible)return!0;0<i&&p();i=0;xMap.Dom.removeEventListener(b,"touchmove",k);xMap.Dom.removeEventListener(b,"touchend",o);xMap.Dom.preventDefault(a)};this.BindEvents=function(a,i,k,o,l,p,O,P,K,u){a&&(a.onmousemove=this.cursorMove,a.onmousedown=this.cursorClick,a.onmouseup=this.cusorClickRelease,l&&(a.addEventListener&&a.addEventListener("DOMMouseScroll",this.mouseWheel,!1),a.onmousewheel=
this.mouseWheel),b=a,d=i,e=k,c=o,f=l,h=K,j=u,g=new xMap.Geometry.Point($(a).offset().left,$(a).offset().top),xMap.Dom.addEventListener(b,"touchstart",this.touchStart))};this.touchStart=function(a){if(!0==xMap.Event.suppressMouse||!0==xMap.UI.xPaneVisible)return!0;if(a.touches){i=Math.max(i,a.touches.length);if(1==a.touches.length)d(map,parseInt(a.touches[0].pageX),parseInt(a.touches[0].pageY),parseInt(a.touches[0].pageX-g.X()),parseInt(a.touches[0].pageY-g.Y())),e(b);else if(2==a.touches.length&&
h){var f=parseInt(a.touches[0].pageX-g.X()),c=parseInt(a.touches[0].pageY-g.Y()),j=parseInt(a.touches[1].pageX-g.X()),l=parseInt(a.touches[1].pageY-g.Y());h(b,f,c,j,l)}xMap.Dom.addEventListener(b,"touchmove",k);xMap.Dom.addEventListener(b,"touchend",o);xMap.Dom.preventDefault(a)}};var l=function(b){if(!0==xMap.Event.suppressMouse||!0==xMap.UI.xPaneVisible)return!0;if(d)return xMap.N?g?d(xMap.FocusMap,b.pageX,b.pageY,b.pageX-g.X(),b.pageY-g.Y()):d(xMap.FocusMap,b.pageX,b.pageY,b.layerX,b.layerY):g?
d(xMap.FocusMap,event.clientX+a,event.clientY+a,event.clientX+a-g.X(),event.clientY+a-g.Y()):d(xMap.FocusMap,event.clientX+a,event.clientY+a,event.offsetX,event.offsetY),!1};this.cursorMove=function(a){return l(a)};this.cursorClick=function(a){if(!0==xMap.Event.suppressMouse||!0==xMap.UI.xPaneVisible)return!0;a=xMap.N?a:event;xMap.Event.mouse_shiftKey=a.shiftKey;xMap.Event.mouse_altKey=a.altKey;xMap.Event.mouse_ctrlKey=a.ctrlKey;xMap.Event.mouse_right=a.witch?3==a.witch:a.button?2==a.button:!1;if(e)return e(b),
!1};var p=function(){if(!0==xMap.Event.suppressMouse||!0==xMap.UI.xPaneVisible)return!0;if(c)return c(b),mouse_right=!1};this.cusorClickRelease=function(){p()};this.mouseWheel=function(a){if(!0==xMap.Event.suppressMouse||!0==xMap.UI.xPaneVisible)return!0;f&&f(a)}};xMap.OptionalServices=function(a,b){var d,e;this.Name=function(){return a};this.isDirty=function(){for(var a=0;a<b.length;a++)if(!0==b[a].isDirty())return!0;return!1};this.setDirty=function(){for(var a=0;a<b.length;a++)b[a].setDirty()};this.Init=function(a,f,h){d=document.createElement("div");d.id=h;d.style.cssText="position:absolute;left:0px;top:0px;right:0px;bottom:0px;overflow:hidden";f.appendChild(d);e=[];for(f=0;f<b.length;f++){var j=b[f];j.Init(a,d,h+"_"+f);if(j.Layers())for(var g=0;g<j.Layers().length;g++){var i=
j.Layers()[g];i.visible=0==f;i.optionbox=!0;i.optiongroup=h;e.push(i)}}};this.Refresh=function(){for(var a=0;a<b.length;a++)!1!=b[a].isDirty()&&b[a].Refresh()};this.Move=function(a,f){for(var d=0;d<b.length;d++)b[d].Move(a,f)};this.WheelIn=function(a,f,d){for(var e=0;e<b.length;e++)b[e].WheelIn(a,f,d)};this.OnMouseDown=function(){for(var a=0;a<b.length;a++)b[a].OnMouseDown()};this.Layers=function(){return e};this.Childs=function(){return b}};
xMap.ParentService=function(a,b,d){var e=[],c,f;e.push(b);for(b=0;b<d.length;b++)e.push(d[b]);this.Name=function(){return a};this.isDirty=function(){for(var a=0;a<e.length;a++)if(!0==e[a].isDirty())return!0;return!1};this.setDirty=function(a){for(var b=0;b<e.length;b++)e[b].setDirty(a)};this.Init=function(a,b,d){c=document.createElement("div");c.id=d;c.style.cssText="position:absolute;left:0px;top:0px;right:0px;bottom:0px;overflow:hidden";b.appendChild(c);f=[];b=e[0].Layers()[0];f.push(b);b.childlayers=
[];for(var i=0;i<e.length;i++){var k=e[i];k.Init(a,c,d+"_"+i);if(k.Layers())for(var o=0==i?1:0;o<k.Layers().length;o++){var l=k.Layers()[o];l.parent=b;b.childlayers.push(l)}}};this.Refresh=function(){for(var a=0;a<e.length;a++)!1!=e[a].isDirty()&&e[a].Refresh()};this.Move=function(a,b){for(var f=0;f<e.length;f++)e[f].Move(a,b)};this.WheelIn=function(a,b,f){for(var c=0;c<e.length;c++)e[c].WheelIn(a,b,f)};this.OnMouseDown=function(){for(var a=0;a<e.length;a++)e[a].OnMouseDown()};this.Layers=function(){return f};
this.Childs=function(){return e}};xMap.Marker=function(a,b,d,e){this.ImageUrl=a;this.Margin=b;this.Name=d;this.OnClick=e;this.Position=null;this.AppendTo=function(a,b,e,j,g){var i=new xMap.Geometry.Rectangle(parseInt(Math.round(b.X())+this.Margin[0]),parseInt(Math.round(b.Y())+this.Margin[1]),parseInt(2*-this.Margin[0]),parseInt(-this.Margin[1])),k=document.createElement("img");k.src=this.ImageUrl;k.style.cssText="position:absolute;left:"+Math.round(b.X())+"px;top:"+Math.round(b.Y())+"px;margin-left:"+this.Margin[0]+"px;margin-top:"+
this.Margin[1]+"px";k.id=d;this.Margin&&(k.rectangle=i);a.appendChild(k);e||(e=this.OnClick);e&&(xMap.Dom.addEventListener(k,"click",e),xMap.Dom.addEventListener(k,"touchstart",e),k.style.cursor="pointer",k.lid=j,k.fid=g)}};xMap.MarkerService=function(){var a=[],b=null,d,e=!0,c=[];this.Init=function(a,c){d=a;b=document.createElement("div");b.id=d.Name()+"_markerpane";b.style.cssText="z-index:1000;position:absolute;left:0px;top:0px;width:"+d.ImageWidth()+"px;bottom:"+d.ImageHeight()+"px;overflow:hidden";c.appendChild(b)};this.AddMarker=function(a){c.push(a);e=!0};this.RemoveMarker=function(a){for(var b=[],d=0;d<c.length;d++)null!=c[d]&&c[d].Name!=a&&b.push(c[d]);c=b;this.ClearMarkers(a)};this.ClearMarkers=function(a){for(var c=
b.childNodes.length-1;0<=c;c--)b.childNodes[c].id==a&&b.removeChild(b.childNodes[c])};this.ContainsMarkerRectangle=function(a,c){for(var d=b.childNodes.length-1;0<=d;d--)if(b.childNodes[d].rectangle&&b.childNodes[d].rectangle.Contains(a,c))return!0;return!1};this.Name=function(){return"_markers"};this.isDirty=function(){return e};this.setDirty=function(){e=!0};this.Refresh=function(){b.style.top=b.style.left="0px";b.style.width=d.ImageWidth()+"px";b.style.height=d.ImageHeight()+"px";b.innerHTML="";
d.Extent();for(var a=0;a<c.length;a++){var h=c[a];if(!(null==h||null==h.Position)){var j=d.World2Image(h.Position);h.AppendTo(b,j)}}e=!1};this.Layers=function(){return a};this.Move=function(a,c){b.style.left=a+"px";b.style.top=c+"px"};this.WheelIn=function(){b.innerHTML=""};this.OnMouseDown=function(){}};xMap.Map=function(a,b,d){function e(a,b){for(var c=0;c<a.length;c++){if(a[c].Name()==b)return a[c];if(a[c].Childs){var f=e(a[c].Childs(),b);if(null!=f)return f}}return null}function c(a){var b=u,c=y,b=(a.X()-l.xMin())*b/l.Width(),a=c-(a.Y()-l.yMin())*c/l.Height();return new xMap.Geometry.Point(b,a)}function f(a,b){var c=u,f=y,b=f-b;return new xMap.Geometry.Point(l.Width()/c*a+l.xMin(),l.Height()/f*b+l.yMin())}function h(a){!0==a&&j(a);for(a=0;a<q.length;a++)!1!=q[a].isDirty()&&q[a].Refresh()}function j(a){for(var b=
0;b<q.length;b++)q[b].setDirty(a)}function g(){for(var a=n,b=0;b<Math.abs(C);b++)a=0<C?a+0.1*a:a-0.1*a;return a}function i(a,b,c,f,d){n=a;a=b/v*n;c=c/v*n;p=l;l=new xMap.Geometry.Bounds([f-a/2,d-c/2,f+a/2,d+c/2]);j(!1)}var k=a.id,o=0,l=new xMap.Geometry.Bounds([0,0,0,0]),p=null,n=0,v=96/0.0254,q=[];(new xMap.Events).BindEvents(a,function(a,b,c,f,d){r=f;F=d;Z=b;A=c;if(Y&&!1==J)if("pan"==H)for(var e=0;e<q.length;e++)q[e].Move(b-aa,c-L);else"box"==H&&(M.style.visibility="visible",M.style.left=Math.min(r,
V)+"px",M.style.top=Math.min(F,w)+"px",M.style.width=Math.abs(V-r)+"px",M.style.height=Math.abs(w-F)+"px");if(Q)for(e=0;e<Q.length;e++)Q[e](a,b,c,f,d)},function(a){Y=!0;V=r;w=F;aa=Z;L=A;for(var b=0;b<q.length;b++)q[b].OnMouseDown();if(R)for(b=0;b<R.length;b++)R[b](a)},function(a){Y=!1;var b=f(V,w),d=f(r,F);if(!0==J){J=!1;var e=[t[0]-B[0],t[1]-B[1]],b=[x[0]-z[0],x[1]-z[1]],d=n*Math.sqrt(e[0]*e[0]+e[1]*e[1])/Math.sqrt(b[0]*b[0]+b[1]*b[1]),g=c(l.CenterPoint());m=[z[0]+0.5*b[0]-(B[0]+0.5*e[0]),z[1]+0.5*
b[1]-(B[1]+0.5*e[1])];g=f(g.X()-m[0]/(n/d),g.Y()-m[1]/(n/d));i(d,u,y,g.X(),g.Y());h(!1)}else if("pan"==H)e=d.X()-b.X(),d=d.Y()-b.Y(),b=0==e&&0==d?new xMap.Geometry.Point(b.X(),b.Y()):new xMap.Geometry.Point(-e,-d),b.Type=0==e&&0==d?"center":"vector","center"==b.Type&&T.ContainsMarkerRectangle(r,F)||G.OnEvent(b);else if("box"==H){if(e=new xMap.Geometry.Bounds([b.X(),b.Y(),d.X(),d.Y()]),!(1.0E-7>e.Width()||1.0E-7>e.Height())||!T.ContainsMarkerRectangle(r,F))G.OnEvent(e),M.style.visibility="hidden"}else"click"==
H&&!T.ContainsMarkerRectangle(r,F)&&(e=new xMap.Geometry.Point(d.X(),d.Y()),G.OnEvent(e));if(S)for(e=0;e<S.length;e++)S[e](a)},function(a){a||(a=window.event);ca.Start();0==C&&(W=r,X=F);a.wheelDelta?C+=-a.wheelDelta/120:a.detail&&(C+=a.detail/3);for(var a=g(),b=0;b<q.length;b++)q[b].WheelIn(100*(n/a),W,X)},this.OnMouseOut,this.OnMouseEnter,this.OnDblClick,function(a,b,c,f,d){J=!0;B=[b,c];t=[f,d]},function(a,b,c,f,d){z=[b,c];x=[f,d];b=[t[0]-B[0],t[1]-B[1]];c=[x[0]-z[0],x[1]-z[1]];a=[z[0]+0.5*c[0]-
(B[0]+0.5*b[0]),z[1]+0.5*c[1]-(B[1]+0.5*b[1])];b=n*Math.sqrt(b[0]*b[0]+b[1]*b[1])/Math.sqrt(c[0]*c[0]+c[1]*c[1]);a[0]/=n/b;a[1]/=n/b;for(c=0;c<q.length;c++)q[c].Move(a[0],a[1]);for(c=0;c<q.length;c++)q[c].WheelIn(100*(n/b),u/2,y/2)});var Q,R,S,O,P,K;this.HtmlElement=function(){return a};var u=a.offsetWidth,y=a.offsetHeight,I=d?d:[],M=document.createElement("div");M.style.cssText="position:absolute;z-index:1000;left:0px;top:0px;width:px;height:0px;background-color:yellow;visibility:hidden;border:2px solid red;opacity:.4;filter:alpha(opacity=40)";
a.appendChild(M);null==xMap.FocusMap&&(xMap.FocusMap=this);this.DomElement=function(){return a};this.Services=function(){return q};this.ServiceByName=function(a){return e(q,a)};this.Name=function(){return k};this.SetExtent=function(a){if(a!=null){var b=a.CenterPoint(),c=u,f=y,a=Math.max(a.Width()/c*v,a.Height()/f*v);a==0&&(a=1);I&&(I.length>0&&a<I[I.length-1])&&(a=I[I.length-1]);i(a,c,f,b.X(),b.Y())}};this.Extent=function(){return new xMap.Geometry.Bounds([l.xMin(),l.yMin(),l.xMax(),l.yMax()])};this.PrevExtent=
function(){return p};this.SetScale=function(a,b){var c=b?b:l.CenterPoint();i(a,u,y,c.X(),c.Y())};this.Scale=function(){return n};this.Scales=function(a){return a<0||a>=I.length?n:I[a]};this.ScaleIndex=function(){for(var a=0;a<I.length;a++){if(Math.abs(Math.round(I[a])-Math.round(n)<=1))return a;if(n>I[a+1])return-(a+1)}return Number.NaN};this.Resolution=function(){return n/v};this.SRS=function(){return b};this.AddService=function(b){q.push(b);b.Init(this,a,k+"_layer"+o++)};this.ImageWidth=function(){return u};
this.ImageHeight=function(){return y};var da=new xMap.Globals.Timer(function(){u=a.offsetWidth;y=a.offsetHeight;U.Resize();var b=l.CenterPoint();i(n,u,y,b.X(),b.Y());h(true);if(K)for(b=0;b<K.length;b++)K[b]()},1E3);this.Resize=function(){da.Start()};this.AddOnResizeEvent=function(a){K||(K=[]);K.push(a)};this.World2Image=function(a){return c(a)};this.Image2World=function(a,b){return f(a,b)};this.AddEventMouseDown=function(a){R||(R=[]);R.push(a)};this.AddEventMouseUp=function(a){S||(S=[]);S.push(a)};
this.AddEventMouseMove=function(a){Q||(Q=[]);Q.push(a)};this.AddEventActiveToolChanged=function(a){O||(O=[]);O.push(a)};this.AddEventTocMarkerClick=function(a){P||(P=[]);P.push(a)};this.FireTocMarkerClickEvent=function(a){if(P)for(var b=0;b<P.length;b++)P[b](a)};var G=null,ba=null;this.SetActiveTool=function(a){if(G&&G.Button)G.Button.style.backgroundColor=xMap.UI.ToolBackgroundColor;if((G=a)&&G.Button)G.Button.style.backgroundColor=xMap.UI.ActiveToolBackgroundColor;H=G==null?"":G.Type;if(O)for(a=
0;a<O.length;a++)O[a](G)};this.AddTools=function(a){ba=a;for(var b=0;b<a.length;b++){a[b].Map=this;xMap.Tools.Globals.InitToolButton(a[b]);G==null&&this.SetActiveTool(a[b])}};this.Tools=function(){return ba};this.Refresh=function(a){h(a)};var Y=!1,V,w,r,F,Z,A,aa,L,H="",B=[0,0],t=[0,0],z=[0,0],x=[0,0],J=!1;this.IsTouchZooming=function(){return J};var C=0,ca=new xMap.Globals.Timer(function(){var a=g(),b=u/2-W,c=y/2-X,b=b*(a/n),c=c*(a/n),b=f(W+b,X+c);i(a,u,y,b.X(),b.Y());C=0;h(false)},1E3),W,X;this.CreateMarker=
function(a,b,c){switch(a){case "blue":return new xMap.Marker(xMap.Tools.Globals.GetImage("MarkerLocation","styles/img/marker")+"/marker_blue.png",[-13,-41],b,c);case "position_red":return new xMap.Marker(xMap.Tools.Globals.GetImage("MarkerLocation","styles/img/marker")+"/position_red.png",[-19,-19],b,c)}return new xMap.Marker(a,[0,0],b)};this.AppendMarker=function(a,b){a.Position=b;T.AddMarker(a)};this.AppendLonLatMarker=function(a,c){var f=xMap.Proj.FromWGS84(b,c.X(),c.Y());this.AppendMarker(a,f)};
this.RemoveMarker=function(a){T.RemoveMarker(a)};var T=new xMap.MarkerService;this.AddService(T);var U=new function(){var a,b,f;this.Init=function(c){f=c;try{var d=c.DomElement();a=document.createElement("canvas");a.style.cssText="position:absolute;z-index:999;left:0px;top:0px;width:"+d.offsetWidth+"px;height:"+d.offsetHeight+"px";a.width=d.offsetWidth;a.height=d.offsetHeight;d.appendChild(a);b=a.getContext("2d");b.globalAlpha=0.5}catch(e){b=a=null}};this.Resize=function(){if(a){b&&b.clearRect(0,
0,a.width,a.height);a.width=f.ImageWidth();a.style.width=a.width+"px";a.height=f.ImageHeight();a.style.height=a.height+"px"}};var d=[],e=true;this.Name=function(){return"Graphics"};this.isDirty=function(){return e};this.setDirty=function(){e=true};this.Refresh=function(){if(b){a.style.left="0px";a.style.top="0px";b.clearRect(0,0,a.width,a.height);var e=f.DomElement();a.width=e.offsetWidth;a.height=e.offsetHeight;for(e=0;e<d.length;e++){var g=d[e];b.beginPath();if(g.style.fillColor)b.fillStyle=g.style.fillColor;
if(g.style.strokeColor)b.strokeStyle=g.style.strokeColor;if(g.style.lineWidth)b.lineWidth=g.style.lineWidth;switch(g.type){case 5:var i=g.params,h=c(new xMap.Geometry.Point(i.x,i.y)),j=void 0;if(i.r>=0){i=c(new xMap.Geometry.Point(i.x+i.r,i.y));j=h.Distance(i)}else j=-i.r;b.arc(Math.round(h.X()),Math.round(h.Y()),Math.round(j),0,Math.PI*2,true)}g.style.fillColor&&b.fill();g.style.strokeColor&&b.stroke()}}};this.Layers=function(){return[]};this.Move=function(b,c){if(a){a.style.left=b+"px";a.style.top=
c+"px"}};this.WheelIn=function(){b&&b.clearRect(0,0,a.width,a.height)};this.OnMouseDown=function(){};this.AddGraphic=function(a,b,c,f){d.push({name:a,type:b,style:c,params:f});e=true};this.RemoveGraphic=function(a){for(var b=[],c=0;c<d.length;c++)d[c].name!=a&&b.push(d[c]);d=b;e=true};this.RemoveAllGraphics=function(){d=[];e=true}};this.AddService(U);this.GrCircle=5;this.AddGraphic=function(a,b,c,f){if(f){c||(c={fillColor:"blue",strokeColor:"red",lineWidth:1});U.AddGraphic(a,b,c,f)}};this.RemoveGraphic=
function(a){U.RemoveGraphic(a)};this.RemoveAllGraphics=function(){U.RemoveAllGraphics()};this.RefreshGraphics=function(){U.Refresh()}};xMap.CoordBar=function(a,b){b.innerHTML+="<span>longitude:</span><span id='"+b.id+"_x'>0.0</span><span>&nbsp;</span><span>latitude:</span><span id='"+b.id+"_y'>0.0</span>";var d=document.getElementById(b.id+"_x"),e=document.getElementById(b.id+"_y");a.AddEventMouseMove(function(b,f,h,j,g){b=a.Image2World(j,g);b=xMap.Proj.ToWGS84(a.SRS(),b.X(),b.Y());null==b?d.innerHTML=e.innerHTML="":(d.innerHTML=Math.round(1E6*b.X())/1E6,e.innerHTML=Math.round(1E6*b.Y())/1E6)})};
xMap.ToolText=function(a,b){a.AddEventActiveToolChanged(function(a){b&&(b.innerHTML=a.Text)})};xMap.TocMarkerName=function(a,b){a.AddEventTocMarkerClick(function(a){b&&(b.innerHTML="Aus"==a.name||"Keine"==a.name?"Map Tipps":a.name)})};xMap._xTocLayers=[];xMap._xTocMaps=[];xMap._xTocMarkers=[];xMap._xTocSetVis=function(a,b,d){b=xMap._xTocLayers[b];if(!0==b.optionbox)for(var e=0;e<xMap._xTocLayers.length;e++)xMap._xTocLayers[e].optiongroup==b.optiongroup&&(xMap._xTocLayers[e].visible=!1,xMap._xTocLayers[e].service.setDirty());b.visible=d;b.service.setDirty();xMap._xTocMaps[a].Refresh()};xMap._xTocIsVis=function(a){if(!a||!0!=a.visible)return!1;for(;a.parent;)if(a=a.parent,!1==xMap._xTocIsVis(a))return!1;return!0};
xMap._xTocMarkerClick=function(a){for(var b=0;b<xMap._xTocMarkers.length;b++)xMap._xTocMarkers[b].visible=b==a,xMap._xTocMarkers[b].service&&xMap._xTocMarkers[b].service.setDirty(),b==a&&xMap.FocusMap.FireTocMarkerClickEvent(xMap._xTocMarkers[b]);xMap.FocusMap.Refresh()};
xMap.Toc=function(a,b){function d(a,b){c+="<div style='padding-left:20px' id=''>";for(var f=0;f<b.length;f++){var h=b[f],o=xMap._xTocLayers.length;h.service=a;xMap._xTocLayers.push(h);c+="<div id=''><span onclick='this.childNodes[0].checked=!this.childNodes[0].checked;xMap._xTocSetVis("+e+","+o+",this.childNodes[0].checked)'>";c=!0==h.optionbox?c+("<input type='radio' name='"+a.Name()+"' "+(h.visible?"checked='true'":"")+" onclick='xMap._xTocSetVis("+e+","+o+",this.checked)'/>"):c+("<input type='checkbox' "+
(h.visible?"checked='true'":"")+" onclick='xMap._xTocSetVis("+e+","+o+",this.checked)'/>");c+=h.name;c+="</span></div>";h.childlayers&&d(a,h.childlayers)}c+="</div>"}var e=xMap._xTocMaps.length;xMap._xTocMaps.push(a);for(var c="<div style='z-index:0;position:absolute;left:0px;top:0px;right:32px'>",f=0;f<a.Services().length;f++){var h=a.Services()[f],c=c+("<div id=''><span>"+h.Name()+"</span>");d(h,h.Layers());c+="</div>"}c+="</div>";b.innerHTML+=c};
xMap.MarkerToc=function(a,b){function d(a){var b=document.createElement("div");b.style.cssText="padding:6px;width:100px;height:100px;float:left;display:inline";var c=document.createElement("div");c.className="ui-state-default";c.style.cssText="position:absolute;width:100px;height:100px;font-size:8.5pt;font-weight:bold;cursor:pointer;border-radius: 5px 5px 5px 5px";c.id=xMap._xTocMarkers.length;xMap.Dom.addClickListener(c,function(){xMap._xTocMarkerClick(this.id);xMap.UI.ShowPane(null)});var f=document.createElement("img");
f.src="styles/img/marker_white_48.png";f.style.cssText="position:absolute;left:25px;top:16px";c.appendChild(f);f=document.createElement("div");f.style.cssText="position:absolute;bottom:2px;left:2px";f.innerHTML=a.name;c.appendChild(f);b.appendChild(c);return b}var e={name:"Keine",id:"__off"};b.appendChild(d(e));xMap._xTocMarkers.push(e);for(e=0;e<a.Services().length;e++)for(var c=a.Services()[e],f=c.Layers(),h=0;h<f.length;h++){var j=f[h];if(!0==j.isMarker){var g=d(j);b.appendChild(g);xMap._xTocMarkers.push(j);
j.service=c}}};xMap.Presentations=function(a,b,d){function e(a,b){var f="_div_pre_"+c+"_"+b,d="<div id='"+f+"' style='min-height:30px;padding:5px;margin:5px;cursor:pointer;border-radius: 5px 5px 5px 5px' class='ui-state-active'";0==a.DisplayStyle()?(d+="<span style='position:relative;top:6px'>"+a.Name()+"</span>",h[f]=function(a){a=xMap.Dom.Sender(a);xMap._presentations[a.id].Apply(!0,!0)}):1==a.DisplayStyle()&&(d+="<span style='position:relative;top:6px'><span style='color:#404040' id='"+f+"_chk'>(X)&nbsp;</span>"+
a.Name()+"</span>",h[f]=function(a){var a=xMap.Dom.Sender(a),b=0==xMap.$(a.id+"_chk").innerHTML.indexOf("(X)");xMap._presentations[a.id].Apply(!b,!0)});xMap._presentations[f]=a;return d+"</div>"}this.CheckPresentations=function(){var a=0;for(a in xMap._presentations){var b=xMap._presentations[a];if(1==b.DisplayStyle()&&(b=b.Layers(),null!=b)){for(var c=!1,d=0;d<b.length;d++){var e=f.ServiceByName(b[d].name);if(null!=e){for(var e=e.Layers(),g=0;g<b[d].ids.length;g++){for(var i=0;i<e.length;i++)if(e[i].id==
b[d].ids[g]&&!0==e[i].visible){c=!0;break}if(!0==c)break}if(!0==c)break}}xMap.$(a+"_chk").innerHTML=!0==c?"(X)&nbsp;":"(&nbsp;&nbsp;)&nbsp;"}}};var c="",f=a;xMap.PresentationsClass=this;xMap._presentations||(xMap._presentations=[]);for(var a="<div style='z-index:0;font-size:12pt;position:absolute;left:0px;top:0px;right:32px'>",h=[],j=0;j<d.length;j++){var g=d[j];if(g.Childs)if(2==g.DisplayStyle()){var i="_div_pre_"+c+"_"+j,a=a+"<div id='__pres_header' style='height:30px;overflow:hidden;padding:5px;margin:5px;cursor:pointer;border-radius: 5px 5px 5px 5px' class='ui-state-default'>",
a=a+("<div id='"+i+"' style='min-height:30px;cursor:pointer'><span style='position:relative;top:6px'><span style='color:#404040'>(v)</span>&nbsp;"+g.Name()+"</span></div>");h[i]=function(a){for(a=xMap.Dom.Sender(a);a.id!="__pres_header";){a=a.parentNode;if(a==null)return false}if(a.style.height=="30px"){a.style.height="";a.childNodes[0].childNodes[0].childNodes[0].innerHTML="(^)"}else{a.style.height="30px";a.childNodes[0].childNodes[0].childNodes[0].innerHTML="(v)"}};for(i=0;i<g.Childs().length;i++)a+=
e(g.Childs()[i],j+"_"+i);a+="</div>"}else a+=e(g,j);else a+=e(g,j)}b.innerHTML+=a+"</div>";for(var k in h)xMap.Dom.addClickListener(xMap.$(k),h[k]);h=[];xMap.PresentationsClass.CheckPresentations()};
xMap.PresentationGroup=function(a,b,d){var e=[];if(2!=b)for(var c=0;c<d.length;c++)for(var f=0;f<d[c].Layers().length;f++)e.push(d[c].Layers()[f]);this.Name=function(){return a};this.DisplayStyle=function(){return b};this.Layers=function(){return e};this.Childs=function(){return d};this.Apply=function(a,b){for(var c=0;c<d.length;c++)d[c].Apply(a,!1);b&&(xMap.PresentationsClass.CheckPresentations(),xMap.FocusMap.Refresh(),xMap.UI.ShowPane(null))}};
xMap.Presentation=function(a,b,d,e,c){function f(a,b){for(var c=0;c<a.length;c++){var f=h.ServiceByName(a[c].name);if(null!=f)for(var d=f.Layers(),e=0;e<a[c].ids.length;e++)for(var p=0;p<d.length;p++)if(d[p].id==a[c].ids[e]){d[p].visible!=b&&(f.setDirty(),d[p].visible=b);break}}}var h=a;this.Name=function(){return b};this.DisplayStyle=function(){return d};this.Layers=function(){return e};this.Apply=function(a,b){if(null!=e){if(1==d)f(e,a);else if(0==d){if(null==c)for(var i=0;i<h.Services().length;i++)for(var k=
h.Services()[i],o=0;o<k.Layers().length;o++)k.Layers()[o].visible=!1;else f(c,!1);f(e,!0)}b&&(xMap.PresentationsClass.CheckPresentations(),xMap.FocusMap.Refresh(),1!=d&&xMap.UI.ShowPane(null))}}};xMap.Globals.WebMercatorTileConfig=function(a){var b={extent:[-2.0037508342789244E7,-2.0037508342789244E7,2.0037508342789244E7,2.0037508342789244E7],scales:[]};b.scales.push([0,5.91658710909132E8]);for(var d=1;d<a;d++)b.scales.push([d,b.scales[d-1][1]/2]);return b};xMap.WebMercatorConfig=new xMap.Globals.WebMercatorTileConfig(19);xMap.WebMercatorConfig21=new xMap.Globals.WebMercatorTileConfig(21);
xMap.TileService=function(a){function b(a,b,c){return xMap.___iFunc(h,a,b,c)}function d(a,b,c){for(var f=b.id;-1!=f.indexOf("_");)f=f.replace("_","");var d=0,e=!0,g=100,i,h,j,k,l,o,p,q,w=0,r=0;this.Init=function(a,c,f,d,g,t,n,x){i=a;h=c;j=f;k=g;l=d;o=t;p=n;q=x;e=!0;w=r=0;b.style.left=w+"px";b.style.top=r+"px"};this.Draw=function(){if(b&&c&&a&&!1!=e){var A=a.ImageWidth(),n=a.ImageHeight(),L=0==q?1:-1,H=Math.floor(-h/o)+k,B=Math.floor(-j/p)*-L+l,t=Math.floor((A-h)/o)+k,A=Math.floor((n-j)/p)*-L+l,n=
Math.max(Math.min(H,t),0),H=Math.max(Math.max(H,t),0),t=Math.max(Math.min(B,A),0),B=Math.max(Math.max(B,A),0);d=(H-n)*(B-t);if(300<d)alert("Zu viele Tiles: "+d);else for(A=t;A<=B;A++)for(t=n;t<=H;t++){var z=f+"_"+A+"_"+t;if(!this.TileExists(z,A,t)){var x=document.createElement("img");x.style.display="none";x.id=z;var z=parseInt(h+(t-k)*o),J=parseInt(j+(A-l)*p*-L),C=parseInt(h+(t+1-k)*o),v=parseInt(j+(A+1*-L-l)*p*-L),C=Math.abs(C-z),v=Math.abs(v-J);x.rectangle=new xMap.Geometry.Rectangle(z-w,J-r,C,
v);x.className="tile";xMap.N?(x.onload=function(){this.style.display="block"},x.style.cssText="display:none;left:"+(z-w)+"px;top:"+(J-r)+"px;width:"+C+"px;height:"+v+"px"):(x.onload=function(){this.style.display="block"},x.style.cssText="display:none;left:"+(z-w)+"px;top:"+(J-r)+"px;width:"+C+"px;height:"+v+"px;"+(100>g?";filter:alpha(opacity="+g+")":""));x.src=c(i,A,t);b.appendChild(x)}}}};this.SetVisible=function(a){e=a};this.Clear=function(){b&&(b.innerHTML="",r=w=0,b.style.left="0px",b.style.top=
"0px")};this.Clear2=function(){b&&(r=w=0,b.style.left="0px",b.style.top="0px")};this.TileExists=function(a,c,f){for(var d=0;d<b.childNodes.length;d++){var e=b.childNodes[d];if(e&&e.id&&e.id==a){var g=e.rectangle;if(g){var i=0==q?1:-1,a=parseInt(h+(f-k)*o)-w,d=parseInt(j+(c-l)*p*-i)-r,f=parseInt(h+(f+1-k)*o)-w,c=parseInt(j+(c+1*-i-l)*p*-i)-r,f=Math.abs(f-a),c=Math.abs(c-d);if(g.Left()!=a||g.Top()!=d||g.Width()!=f||g.Height()!=c)e.style.left=a+"px",e.style.top=d+"px",e.style.width=f+"px",e.style.height=
c+"px",g.Set(a,d,f,c);return!0}}}return!1};var F=0,v=0;this.OnMouseDown=function(){v=F=0};this.CorrectOrigin=function(a,b){alert(a+" "+b+"\n"+h+" "+j)};this.Move=function(a,c,f){if(b){var d=a-F,e=c-v;F=a;v=c;w+=d;r+=e;b.style.left=w+"px";b.style.top=r+"px";h+=d;j+=e;!0==f&&null!=n&&n.Start()}};this.Trans=function(a){g=a;if(b)if(N)b.style.opacity=a/100,b.style.MozOpacity=a/100,b.style.KhtmlOpacity=a/100;else for(var c=0;c<b.childNodes.length;c++)b.childNodes[c].style.filter=100==a?"":"alpha(opacity='"+
a+"')"};this.WheelIn=function(a,c,f){if(!b)return!0;if(3E3>a)for(var a=a/100,d=0;d<b.childNodes.length;d++){var e=b.childNodes[d],g=e.rectangle;if(g){var i=g.Left()-(c-w),h=g.Top()-(f-r),j=g.Width(),g=g.Height(),i=i*a,h=h*a,j=j*a,g=g*a,h=h+(f-r);e.style.left=i+(c-w)+"px";e.style.top=h+"px";e.style.width=j+"px";e.style.height=g+"px"}}return!0}}var e=null,c=null,f=a.config,h=a.tileUrl,j=a.orientation?a.orientation:1,g=new xMap.Geometry.Point;g.SetXY(f.extent[0],-1==j?f.extent[3]:f.extent[1]);var i=
a.tileSizeX?a.tileSizeX:256,k=a.tileSizeY?a.tileSizeY:256,o=a.tileUrlFunction?a.tileUrlFunction:b,l=[{name:a.name,id:a.layerId?a.layerId:0,visible:!1==a.layerVisible?!1:!0}],p=null,n=null,v=!0,q=-1;this.Init=function(a,b,f){c=a;e=document.createElement("div");e.id=f;e.style.cssText="position:absolute;left:0px;top:0px;right:0px;bottom:0px;overflow:visible";b.appendChild(e);p=new d(c,e,o);n=new xMap.Globals.Timer(function(){p.Draw()},10)};this.Name=function(){return l[0].name};this.isDirty=function(){return v};
this.setDirty=function(a){v=!0;if(!1==xMap._xTocIsVis(l[0])||!0==a)q=-1};this.Refresh=function(){if(!(null==c||null==e)){if(1.0E-7<Math.abs(q-c.Scale())){q=c.Scale();e.innerHTML="";p.Clear();if(!1==xMap._xTocIsVis(l[0])){q=1;return}var a=c.Extent(),b;a:{b=Math.round(c.Scale());for(var d=0;d<f.scales.length;d++)if(Math.round(f.scales[d][1])<=b){b=d;break a}b=f.scales.length-1}for(var h,o,n,u,y;;){n=f.scales[b][1]/(96/0.0254);y=a.xMin();u=n;y=Math.floor((y-g.X())/(i*u));u=a.yMax();o=n;o=u=Math.floor((u-
g.Y())/(k*o))*j;h=y;a=n;h=g.X()+h*i*a;d=void 0;d=-1==j?g.Y()-o*k*a:g.Y()+(o+1)*k*a;h=new xMap.Geometry.Point(h,d);o=c.World2Image(h);a=c.World2Image(new xMap.Geometry.Point(h.X()+i*n,h.Y()));h=c.World2Image(new xMap.Geometry.Point(h.X(),h.Y()+k*n));n=o.Distance(a);h=o.Distance(h);if(100<n&&100<h)break;break}p.Init(f.scales[b][0],o.X(),o.Y(),u,y,n,h,-1==j?1:0);p.Draw()}v=!1}};this.Layers=function(){return l};this.Move=function(a,b){!1!=xMap._xTocIsVis(l[0])&&p.Move(a,b,!1==c.IsTouchZooming())};this.WheelIn=
function(a,b,c){!1!=xMap._xTocIsVis(l[0])&&p.WheelIn(a,b,c)};this.OnMouseDown=function(){p.OnMouseDown()}};xMap.___iFunc=function(a,b,d,e){for(;-1!=a.indexOf("{0}");)a=a.replace("{0}",e);for(;-1!=a.indexOf("{1}");)a=a.replace("{1}",d);for(;-1!=a.indexOf("{2}");)a=a.replace("{2}",b);return a};function zeroPad(a,b){for(var a=""+a,d="",e=0;e<b;++e)d+="0";return d.substring(0,b-a.length)+a}function dec2hex(a){return a.toString(16)}function hex2dec(a){return parseInt(a,16)}
xMap.OsmTileService=function(){var a=["a","b","c"];return new xMap.TileService(new xMap.Globals.WebMercatorTileConfig(19),"http://tile.openstreetmap.org/{2}/{0}/{1}.png","Open Street Map",-1,function(b,d,e){var c=Math.floor(3*Math.random());return xMap.___iFunc("http://"+a[c]+".tile.openstreetmap.org/{2}/{0}/{1}.png",b,d,e)})};
xMap.OsmCycleTileService=function(){var a=["a","b","c"];return new xMap.TileService(new xMap.Globals.WebMercatorTileConfig(19),"http://c.tile.opencyclemap.org/cycle/{2}/{0}/{1}.png","OSM Cycle Map",-1,function(b,d,e){var c=Math.floor(3*Math.random());return xMap.___iFunc("http://"+a[c]+".tile.opencyclemap.org/cycle/{2}/{0}/{1}.png",b,d,e)})};
xMap.OsmTransportTileService=function(){var a=["a","b","c"];return new xMap.TileService(new xMap.Globals.WebMercatorTileConfig(19),"http://c.tile2.opencyclemap.org/transport/{2}/{0}/{1}.png","OSM Transport Map",-1,function(b,d,e){var c=Math.floor(3*Math.random());return xMap.___iFunc("http://"+a[c]+".tile2.opencyclemap.org/transport/{2}/{0}/{1}.png",b,d,e)})};
xMap.OpenSeaMapTileService=function(){return new xMap.TileService(new xMap.Globals.WebMercatorTileConfig(19),"http://tiles.openseamap.org/seamark/{2}/{0}/{1}.png","Open Sea Map",-1)};xMap.GoogleMapsTileService=function(){return new xMap.TileService(new xMap.Globals.WebMercatorTileConfig(21),"http://mt0.google.com/vt/lyrs=m@121&hl=de&x={0}&y={1}&z={2}","Google Maps",-1)};
xMap.GoogleSatelliteTileService=function(){return new xMap.TileService(new xMap.Globals.WebMercatorTileConfig(21),"https://khms1.google.at/kh/v=111&src=app&x={0}&s=&y={1}&z={2}","Google Satellite",-1)};xMap.GoogleLabelTileService=function(){return new xMap.TileService(new xMap.Globals.WebMercatorTileConfig(21),"https://mts0.google.com/vt/lyrs=h@177000000&hl=de&src=app&x={0}&s=&y={1}&z={2}","Google Label",-1)};
xMap.YahooStreetTileService=function(){return new xMap.TileService(new xMap.Globals.WebMercatorTileConfig(19),"http://us.maps2.yimg.com/us.png.maps.yimg.com/png?v=3.52&t=m&x={0}&y={1}&z={2}","Yahoo Streets",-1,function(a,b,d){var e=Math.pow(2,a)/2;return xMap.___iFunc("http://us.maps2.yimg.com/us.png.maps.yimg.com/png?v=3.52&t=m&x={0}&y={1}&z={2}",18-a,b<e?e-b-1:-1*(b+1-e),d)})};
xMap.YahooAerialTileService=function(){return new xMap.TileService(new xMap.Globals.WebMercatorTileConfig(19),"http://us.maps3.yimg.com/aerial.maps.yimg.com/tile?v=1.7&t=a&x={0}&y={1}&z={2}","Yahoo Arial",-1,function(a,b,d){var e=Math.pow(2,a)/2;return xMap.___iFunc("http://us.maps3.yimg.com/aerial.maps.yimg.com/tile?v=1.7&t=a&x={0}&y={1}&z={2}",18-a,b<e?e-b-1:-1*(b+1-e),d)})};
xMap.YahooHybridTileService=function(){return new xMap.TileService(new xMap.Globals.WebMercatorTileConfig(19),"http://us.maps3.yimg.com/aerial.maps.yimg.com/png?v=2.2&t=h&x={0}&y={1}&z={2}","Yahoo Labels",-1,function(a,b,d){var e=Math.pow(2,a)/2;return xMap.___iFunc("http://us.maps3.yimg.com/aerial.maps.yimg.com/png?v=2.2&t=h&x={0}&y={1}&z={2}",18-a,b<e?e-b-1:-1*(b+1-e),d)})};xMap.WmsService=function(a){var b=a.url,d=a.name,e=a.layers,c=null,f,h=!0,j=new xMap.Geometry.Point(0,0);this.Init=function(a,b,d){f=a;c=document.createElement("img");c.id=d;c.style.cssText="position:absolute;left:0px;top:0px;width:"+f.ImageWidth()+"px;bottom:"+f.ImageHeight()+"px;overflow:hidden";xMap.Dom.addEventListener(c,"load",function(){-1==c.src.indexOf("empty.gif")&&(c.style.display="block")});b.appendChild(c)};this.Name=function(){return d};this.isDirty=function(){return h};this.setDirty=
function(){h=!0};this.Refresh=function(){c.src="styles/img/empty.gif";c.style.display="none";c.style.top=c.style.left="0px";c.style.width=f.ImageWidth()+"px";c.style.height=f.ImageHeight()+"px";j.SetXY(0,0);for(var a=f.Extent(),d=b+(0<b.indexOf("?")?"&":"?"),d=d+("SERVICE=WMS&VERSION=1.1.1&REQUEST=GetMap&WIDTH="+f.ImageWidth()+"&HEIGHT="+f.ImageHeight()),d=d+("&BBOX="+a.xMin()+","+a.yMin()+","+a.xMax()+","+a.yMax()),d=d+"&FORMAT=image/png&TRANSPARENT=TRUE",k=a="",o=0;o<e.length;o++)xMap._xTocIsVis(e[o])&&
(0<a.length&&(a+=",",k+=","),a+=e[o].id,k+=e[o].style);d=d+("&LAYERS="+a+"&STYLES="+k)+("&SRS="+f.SRS());0<a.length&&(c.src=d);h=!1};this.Layers=function(){return e};this.Move=function(a,b){c.style.left=a+"px";c.style.top=b+"px";j.SetXY(a,b)};this.WheelIn=function(a,b,d){var e=f.ImageWidth(),h=f.ImageHeight(),p,n;p=b*(a/100);n=d*(a/100);e=Math.round(e*(a/100));h=Math.round(h*(a/100));b=b-p+j.X()*(a/100);a=d-n+j.Y()*(a/100);c.style.cssText="z-index:"+c.style.zIndex+";position:absolute;left:"+b+"px;top:"+
a+"px;width:"+e+"px;height:"+h+"px;"};this.OnMouseDown=function(){}};xMap.GeoJsonService=function(a){var b=a.url,d=a.name,e=a.layers,c=null,f,h=!0,j=new xMap.AJAX(function(a){if(""!=a){var a=eval("("+a+")"),b;g?f.RemoveGraphic(d):(f.RemoveMarker(d),b=f.CreateMarker("blue",d));for(var e=0,j=a.features.length;e<j;e++){var p=a.features[e];if(p.geometry&&"Point"==p.geometry.type)if(g)f.AddGraphic(d,f.GrCircle,{fillColor:"blue",strokeColor:"red",lineWidth:1},{x:p.geometry.coordinates[0],y:p.geometry.coordinates[1],r:-5});else{var n=f.World2Image(new xMap.Geometry.Point(p.geometry.coordinates[0],
p.geometry.coordinates[1]));b.AppendTo(c,n,p.onclick,p.lid,p.fid)}}h=!1;g&&f.RefreshGraphics()}}),g=!0==a.useCanvas?!0:!1;if(e){if(!g)for(a=0;a<e.length;a++)e[a].isMarker=!0}else e=[];this.Init=function(a){f=a;c=xMap.$(f.Name()+"_markerpane")};this.Name=function(){return d};this.isDirty=function(){return h};this.setDirty=function(){h=!0};this.Refresh=function(){for(var a=f.Extent(),c=b+(0<b.indexOf("?")?"&":"?"),c=c+("WIDTH="+f.ImageWidth()+"&HEIGHT="+f.ImageHeight()),c=c+("&BBOX="+a.xMin()+","+a.yMin()+
","+a.xMax()+","+a.yMax()),c=c+("&SRS="+f.SRS()),a="",h=0;h<e.length;h++)!0==e[h].visible&&(0<a.length&&(a+=",",s+=","),a+=e[h].id);c+="&LAYERS="+a;f.RemoveMarker(d);j.abort();j.SendAsynchronGet(c)};this.Layers=function(){return e};this.Move=function(){};this.WheelIn=function(){c.innerHTML=""};this.OnMouseDown=function(){}};xMap.Tools={};
xMap.Tools.Globals=new function(){this.InitToolButton=function(a){a&&a.Init&&a.Init();if(a&&a.Button){if(0==a.Button.childNodes.length){var b=document.createElement("img");b.src=a.ImageUrl;a.Button.appendChild(b)}a.Button.style.backgroundColor=xMap.UI.ToolBackgroundColor;a.Button.style.cursor="pointer";a.Button.onmouseover=function(){xMap.Event.suppressMouse=!0};a.Button.onmouseout=function(){xMap.Event.suppressMouse=!1};a.Button.onclick||("button"==a.Type?(a.Button.onclick=function(b){a.OnClick();return xMap.Dom.cancelEvent(b)},
xMap.Dom.addEventListener(a.Button,"touchstart",function(b){a.Button.onclick(b);return!1})):a.Button.onclick=function(){a.Map.SetActiveTool(a)},xMap.Event.suppressMouse=!1)}};this.Images=[];this.GetImage=function(a,b){return this.Images[a]?this.Images[a]:b};this._delegateEventArg=null;this.delegateLastArg=function(a){if(!(null==xMap.FocusMap||null==xMap.FocusMap.Tools()||null==xMap.Tools.Globals._delegateEventArg)){for(var b=0;b<xMap.FocusMap.Tools().length;b++)if(xMap.FocusMap.Tools()[b].Name==a){xMap.FocusMap.Tools()[b].OnEvent(xMap.Tools.Globals._delegateEventArg);
break}xMap.Tools.Globals._delegateEventArg=null}}};xMap.Tools.Refresh=function(a){this.Type="button";this.Button=a;this.Map=null;this.IsClickTool=!0;this.Name="xMap.Refresh";this.ImageUrl=xMap.Tools.Globals.GetImage("Refresh","styles/img/refresh_48.png");this.Text="Karte neu aufbauen";this.OnEvent=function(){null!=this.Map&&this.Map.Refresh(force)}};
xMap.Tools.Pan=function(a){this.Type="pan";this.Button=a;this.Map=null;this.IsClickTool=!0;this.Name="xMap.Pan";this.ImageUrl=xMap.Tools.Globals.GetImage("Pan","styles/img/cursor_hand_48.png");this.Text="Karte verschieben";this.OnEvent=function(a){var d=this.Map.Extent();if("center"==a.Type){var e=this.Map.World2Image(d.CenterPoint()),c=this.Map.World2Image(a),d=e.X()-c.X(),e=e.Y()-c.Y();(new xMap.Globals.Animation(function(a){for(var b=a[0],c=a[1],d=a[3],e=a[2],k=Math.max((d-e)/4,1),e=Math.min(d,
e+k),b=b/d*e,c=c/d*e,k=0;k<a[4].Services().length;k++)a[4].Services()[k].Move(b,c);if(e>=d)return!1;a[2]=e;return a},[Math.round(d),Math.round(e),0,Math.sqrt(d*d+e*e),this.Map,a.X(),a.Y()],10,function(a){var b=a[4].Extent();a[4].SetExtent(new xMap.Geometry.Bounds([a[5]-b.Width()/2,a[6]-b.Height()/2,a[5]+b.Width()/2,a[6]+b.Height()/2]));a[4].Refresh(!1)})).Start()}else this.Map.SetExtent(new xMap.Geometry.Bounds([d.xMin()+a.X(),d.yMin()+a.Y(),d.xMax()+a.X(),d.yMax()+a.Y()])),this.Map.Refresh(!1)}};
xMap.Tools.ZoomIn=function(a){this.Type="box";this.Button=a;this.Map=null;this.IsClickTool=!0;this.Name="xMap.ZoomIn";this.ImageUrl=xMap.Tools.Globals.GetImage("ZoomIn","styles/img/zoom_in_48.png");this.Text="Vergößern (Zoom In)";this.OnEvent=function(a){if(1.0E-7>a.Width()||1.0E-7>a.Height()){var d=this.Map.World2Image(a.CenterPoint()),e=this.Map.Scale(),c=this.Map.ScaleIndex(),c=0>c?this.Map.Scales(-c):this.Map.Scales(c+1);(new xMap.Globals.Animation(function(a){for(var b=a[3]-(a[3]-a[4])/4,c=0;c<
a[0].Services().length;c++)a[0].Services()[c].WheelIn(100*(a[2]/b),a[1].X(),a[1].Y());if(Math.round(b)<=Math.round(a[4]))return!1;a[3]=b;return a},[this.Map,d,e,e,c,a],10,function(a){var b=a[0].ImageWidth()/2-a[1].X(),c=a[0].ImageHeight()/2-a[1].Y(),b=b*(a[4]/a[2]),c=c*(a[4]/a[2]),b=a[1].X()+b,c=a[1].Y()+c,c=a[0].Image2World(b,c);a[0].SetScale(a[4],c);a[0].Refresh(!1)})).Start()}else this.Map.SetExtent(a);this.Map.Refresh(!1)}};
xMap.Tools.ZoomInStatic=function(a){this.Type="button";this.Button=a;this.Map=null;this.IsClickTool=!0;this.Name="xMap.ZoomInStatic";this.ImageUrl=xMap.Tools.Globals.GetImage("ZoomInStatic","styles/img/zoom_in_48.png");this.Text="Vergößern (Zoom In)";var b=new xMap.Tools.ZoomIn(null);this.OnClick=function(){if(null!=this.Map){b.Map=this.Map;var a=this.Map.Extent().CenterPoint();b.OnEvent(new xMap.Geometry.Bounds([a.X(),a.Y(),a.X(),a.Y()]))}}};
xMap.Tools.ZoomOut=function(a){this.Type="box";this.Button=a;this.Map=null;this.IsClickTool=!0;this.Name="xMap.ZoomOut";this.ImageUrl=xMap.Tools.Globals.GetImage("ZoomOut","styles/img/zoom_out_48.png");this.Text="Verkleinern (Zoom Out)";this.OnEvent=function(a){if(1.0E-7>a.Width()||1.0E-7>a.Height()){var d=this.Map.World2Image(a.CenterPoint()),e=this.Map.Scale(),c=this.Map.ScaleIndex(),c=0>c?this.Map.Scales(-c-1):this.Map.Scales(c-1);(new xMap.Globals.Animation(function(a){for(var b=a[3]-(a[3]-a[4])/
4,c=0;c<a[0].Services().length;c++)a[0].Services()[c].WheelIn(100*(a[2]/b),a[1].X(),a[1].Y());if(Math.round(b)>=Math.round(a[4]))return!1;a[3]=b;return a},[this.Map,d,e,e,c,a],10,function(a){var b=a[0].ImageWidth()/2-a[1].X(),c=a[0].ImageHeight()/2-a[1].Y(),b=b*(a[4]/a[2]),c=c*(a[4]/a[2]),b=a[1].X()+b,c=a[1].Y()+c,c=a[0].Image2World(b,c);a[0].SetScale(a[4],c);a[0].Refresh(!1)})).Start()}else d=this.Map.Extent(),e=d.Width()/a.Width(),c=d.Height()/a.Height(),a=a.CenterPoint(),this.Map.SetExtent(new xMap.Geometry.Bounds([a.X()-
d.Width()/2*e,a.Y()-d.Height()/2*c,a.X()+d.Width()/2*e,a.Y()+d.Height()/2*c]));this.Map.Refresh(!1)}};
xMap.Tools.ZoomOutStatic=function(a){this.Type="button";this.Button=a;this.Map=null;this.IsClickTool=!0;this.Name="xMap.ZoomOut";this.ImageUrl=xMap.Tools.Globals.GetImage("ZoomOutStatic","styles/img/zoom_out_48.png");this.Text="Verkleinern (Zoom Out)";var b=new xMap.Tools.ZoomOut(null);this.OnClick=function(){if(null!=this.Map){b.Map=this.Map;var a=this.Map.Extent().CenterPoint();b.OnEvent(new xMap.Geometry.Bounds([a.X(),a.Y(),a.X(),a.Y()]))}}};
xMap.Tools.Find=function(a,b){this.Type="button";this.Button=a;this.Map=null;this.ImageUrl=xMap.Tools.Globals.GetImage("Find","styles/img/find_48.png");xMap.UI.InitPane(b);this.OnClick=function(){xMap.UI.ShowPane(b)}};xMap.Tools.Toc=function(a,b){this.Type="button";this.Button=a;this.Map=null;this.ImageUrl=xMap.Tools.Globals.GetImage("Toc","styles/img/toc_48.png");xMap.UI.InitPane(b);this.OnClick=function(){xMap.UI.ShowPane(b)}};
xMap.Tools.Presentations=function(a,b){this.Type="button";this.Button=a;this.Map=null;this.ImageUrl=xMap.Tools.Globals.GetImage("Presentations","styles/img/toc_48.png");xMap.UI.InitPane(b);this.OnClick=function(){xMap.UI.ShowPane(b)}};xMap.Tools.MarkerSelector=function(a,b){this.Type="button";this.Button=a;this.Map=null;this.ImageUrl=xMap.Tools.Globals.GetImage("MarkerSelector","styles/img/marker_white_48.png");xMap.UI.InitPane(b);this.OnClick=function(){xMap.UI.ShowPane(b)}};
xMap.Tools.TileButtons=function(a,b){this.Type="button";this.Button=a;this.Map=null;this.ImageUrl=xMap.Tools.Globals.GetImage("TileButtons","styles/img/tools_48.png");xMap.UI.InitPane(b);this.OnClick=function(){xMap.UI.ShowPane(b)}};
xMap.Tools.ZoomBack=function(a){this.Type="button";this.Button=a;this.Map=null;this.ImageUrl=xMap.Tools.Globals.GetImage("ZoomBack","styles/img/back_white_48.png");this.Text="Zoom zurück";this.OnClick=function(){null!=this.Map&&null!=this.Map.PrevExtent()&&(this.Map.SetExtent(this.Map.PrevExtent()),this.Map.Refresh(!0))}};
xMap.Tools.ZoomBookmark=function(a,b,d,e){this.Type="button";this.Button=a;this.Map=null;this.ImageUrl=d;this.Text=e;this._env=b;this.OnClick=function(){null!=this.Map&&null!=this._env&&(this.Map.SetExtent(this._env),this.Map.Refresh(!0))}};
xMap.Tools.ZoomGeolocation=function(a){this.Type="button";this.Button=a;this.Map=null;this.ImageUrl=xMap.Tools.Globals.GetImage("ZoomGeolocation","styles/img/location_white_48.png");this.Text="Zoom auf Standpunkt";_onStartGetLocation=[];_onGetLocation=[];_onGetLocationError=[];this.AddOnStartGetLocaton=function(a){_onStartGetLocation.push(a)};this.AddOnGetLocaton=function(a){_onGetLocation.push(a)};this.AddOnGetLocatonError=function(a){_onGetLocationError.push(a)};this.OnClick=function(){function a(b){for(var d=
0;d<_onGetLocationError.length;d++)_onGetLocationError[d](b);alert("Fehler beim Ortungsversuch: "+b.code)}function d(a){for(var b=0;b<_onGetLocation.length;b++)_onGetLocation[b](a);var b=xMap.Proj.FromWGS84(e.SRS(),a.coords.longitude,a.coords.latitude),d=a.coords.accuracy,j=new xMap.Geometry.Bounds([b.X()-d/2,b.Y()-d/2,b.X()+d/2,b.Y()+d/2]),g=e.CreateMarker("position_red","geolocation");e.AppendLonLatMarker(g,new xMap.Geometry.Point(a.coords.longitude,a.coords.latitude));e.AddGraphic("geolocation",
e.GrCircle,{fillColor:"rgba(155, 155, 155, 0.3)",strokeColor:"red",lineWidth:2},{x:b.X(),y:b.Y(),r:d/2});e.SetExtent(j);a=e.ScaleIndex();a=0<=a?a:Math.abs(a);0<a&&e.SetScale(e.Scales(a-1));e.Refresh(!0)}var e=this.Map;(function(){e.RemoveMarker("geolocation");e.RemoveGraphic("geolocation");for(var c=0;c<_onStartGetLocation.length;c++)_onStartGetLocation[c]();navigator.geolocation?navigator.geolocation.getCurrentPosition(d,a,{timeout:15E3}):alert("Ortung wird nicht unterstützt")})()}};
xMap.Tools.Navigate=function(a){this.Type="pan";this.Button=a;this.Map=null;this.ImageUrl=xMap.Tools.Globals.GetImage("Navigate","styles/img/cursor_hand_48.png");var b;this.Init=function(){if(null!=this.Map){b=document.createElement("div");b.style.cssText="z-index:9999;position:absolute;left:0px;top:0px;right:0px;bottom:0px;display:none;font-size: 8.5pt;font-weight: bold;";b.align="center";document.body.appendChild(b);var a=document.createElement("img");a.style.cssText="position:absolute;right:0px;top:0px;width:32px;height:32px;cursor:pointer";
a.src="styles/img/close_32.png";xMap.Dom.addEventListener(a,"click",function(){b.style.display="none";xMap.UI.Unlock()});b.appendChild(a);a=document.createElement("span");a.style.cssText="font-size:14pt";a.innerHTML="Aktion wählen:";b.appendChild(a);a=document.createElement("div");a.style.cssText="display:table";b.appendChild(a);for(var e=this.Map.Tools(),c=0;c<e.length;c++){var f=e[c];if(!(!0!=e[c].IsClickTool||null!=e[c].Button)){var h=document.createElement("div");h.style.cssText="padding: 6px; margin:6px; width: 100px; height: 100px; float:left; diplay:inline; cursor:pointer; background-color:white; filter:alpha(opacity=100);";
h.align="center";h.id=f.Name;var j=document.createElement("div");j.style.cssText="position:absolute;width:100px;height:100px";j.align="center";h.appendChild(j);var g=document.createElement("img");g.src=e[c].ImageUrl;j.appendChild(g);f.Text&&(g=document.createElement("div"),g.style.cssText="position:absolute;bottom:2px;left:2px",g.innerHTML=f.Text,j.appendChild(g));h.onclick=function(){xMap.Tools.Globals.delegateLastArg(this.id);b.style.display="none";xMap.UI.Unlock()};a.appendChild(h)}}}};this.OnEvent=
function(a){var e=this.Map.Extent();"center"==a.Type?(a.Width=function(){return 0},a.Height=function(){return 0},a.CenterPoint=function(){return new xMap.Geometry.Point(a.X(),a.Y())},xMap.Tools.Globals._delegateEventArg=a,xMap.UI.Lock(),b.style.display="block"):(this.Map.SetExtent(new xMap.Geometry.Bounds([e.xMin()+a.X(),e.yMin()+a.Y(),e.xMax()+a.X(),e.yMax()+a.Y()])),this.Map.Refresh(!1))}};xMap.Json=new function(){this.QueryResultsToHtml=function(a,b,d){if(!a)return"";var e="";b&&(b.style.display="block");if(a.responseData&&a.responseData.results){e+="<ul style='padding:2px'>";for(b=0;b<a.responseData.results.length;b++){var c=a.responseData.results[b],e=e+("<li id='_queryresult_"+b+"' style='background-color:#efefef;cursor:pointer;margin:2px' >"),e=e+("<h3>"+c.title+"</h3>");if(c.addressLines&&0<c.addressLines.length)for(var f=0;f<c.addressLines.length;f++)e+=c.addressLines[f]+"<br/>";
else if(c.postalCode||c.city||c.streetAddress||c.region)e+=(c.postalCode?c.postalCode:"")+" "+(c.city?c.city:"")+" "+(c.streetAddress?c.streetAddress:"")+" "+(c.region?c.region:"")+"<br>";if(c.phoneNumbers&&0<c.phoneNumbers.length)for(f=0;f<c.phoneNumbers.length;f++)e+=(""!=c.phoneNumbers[f].type?c.phoneNumbers[f].type+": ":"")+c.phoneNumbers[f].number+"<br/>";c.staticMapUrl&&""!=c.staticMapUrl&&(e+="<img src='"+c.staticMapUrl+"' />");c.content&&""!=c.content&&(e+="<p>"+c.content+"</p>");e+="</li>"}e+=
"</ul>"}d.innerHTML=e;for(b=0;b<a.responseData.results.length;b++)c=a.responseData.results[b],xMap.$("_queryresult_"+b).res=c,xMap.Dom.addClickListener(xMap.$("_queryresult_"+b),function(a){for(var b=xMap.Dom.Sender(a);!b.res;){b=b.parentNode;if(!b)return}if(a=xMap.Proj.FromWGS84(xMap.FocusMap.SRS(),b.res.lng,b.res.lat)){xMap.FocusMap.SetScale(xMap.WebMercatorConfig21.scales[8+parseInt(b.res.accuracy)][1],a);a=xMap.FocusMap;a.RemoveMarker("queryresult");a.AppendLonLatMarker(a.CreateMarker("blue",
"queryresult",function(){xMap.Event.OnQueryResultMarkerClick(b.id)}),new xMap.Geometry.Point(b.res.lng,b.res.lat));a.Refresh(true);xMap.UI.ShowPane(null)}})}};xMap.UI=new function(){this.xPaneVisible=!1;this.ToolBackgroundColor="#000000";this.ActiveToolBackgroundColor="#e9e9e9";var a,b=null,d="";this.ShowPane=function(b){var c=xMap.$("xMap.Pane");c&&((a&&(a.style.display="none",c.style.display="none",this.xPaneVisible=!1),null==b)?(a=null,this.HighlightMarker(null),this.xPaneVisible=!1):(c.parentNode!==xMap.FocusMap.DomElement()&&xMap.FocusMap.DomElement().appendChild(c),b&&b!==a&&(c.style.opacity=!xMap.N?100:0,this.xPaneVisible=!0,xMap.$("xMap.Pane.Title").innerHTML=
b.title?b.title:"Dialog",b.style.display="block",c.style.display="block",c=new xMap.Globals.Animation(function(a){if(xMap.N)a[0].parentNode.style.opacity=a[1]/110;a[0].style.left=parseInt(-300+a[1]*3)+"px";a[1]=a[1]+5;return a[1]>=100?false:a},[b,0,b.style.left],10,function(a){a[0].style.left=a[2]}),xMap.N&&c.Start()),a=b===a?null:b))};this.InitPane=function(a){var b=xMap.$("xMap.Pane");if(!b){b=document.createElement("div");b.id="xMap.Pane";b.style.cssText="z-index:9999;position:absolute;display:none;background-color:white;left:"+
a.style.left+";right:"+a.style.right+";top:"+a.style.top+";bottom:"+a.style.bottom;var d=document.createElement("div");d.id="xMap.Pane.Header";d.className="ui-widget-header";d.style.cssText="position:absolute;left:0px;top:0px;right:0px;height:32px;";d.innerHTML='<span id="xMap.Pane.Title" style="margin:7px;font-size:14pt;">Dialog</span>';b.appendChild(d);var h=document.createElement("img");h.style.cssText="z-index:1000;position:absolute;right:0px;top:0px;width:32px;height:32px;cursor:pointer";h.src=
xMap.Tools.Globals.GetImage("ClosePane","styles/img/close_32.png");d.appendChild(h);xMap.Dom.addEventListener(h,"click",function(){xMap.UI.ShowPane(null)});document.body.appendChild(b)}a.style.cssText="position:absolute;left:2px;top:34px;right:2px;bottom:2px;display:none;overflow:"+a.style.overflow;b.appendChild(a);("auto"==a.style.overflow||"scroll"==a.style.overflow)&&xMap.Dom.touchScroll(a)};this.MarkerClick=function(a,b){this.HighlightMarker(b);xMap.Dom.preventDefault(a)};this.HighlightMarker=
function(a){b&&(b.src=d);if(b=a)d=a.src,a.src="styles/img/marker/marker_highlighed.png"};this.ShowToolBar=function(a,b){if(a){var d=parseInt(a.style.width.replace("px","")),h=0;if(0==d)if(!0==b)var h=a.style.left?parseInt(a.style.left.replace("px","")):0,j=a.style.right?parseInt(a.style.right.replace("px","")):0,h=xMap.FocusMap.ImageWidth()-h-j;else for(j=0;j<a.childNodes.length;j++)if(3!=a.childNodes[j].nodeType)var g=a.childNodes[j],h=g.style.width?h+parseInt(g.style.width.replace("px","")):h+54;
(new xMap.Globals.Animation(function(a){var b=Math.max(Math.abs(a[1]-a[2])/5,1);!0==a[3]?(a[2]+=b,a[2]>a[1]&&(a[2]=a[1])):(a[2]-=b,a[2]<a[1]&&(a[2]=a[1]));a[0].style.width=a[2]+"px";return a[2]==a[1]?!1:a},[a,h,d,h>d],10,function(){})).Start()}};this.Init=function(){xMap._xTocLayers=[];xMap._xTocMaps=[];xMap._xTocMarkers=[];xMap._presentations=[];xMap.FocusMap=null;this.xPaneVisible=!1;xMap.Dom.appendStyleSheet("xMap.Image.Tile","img.tile{position: absolute;border: none;margin: 0px;padding: 0px;-moz-user-select: none;background-color:none;}")}};
xMap.UI.TileButton=function(a,b,d){xMap.Dom.addEventListener(b,"click",function(){return!1});var e=document.createElement("div");e.style.cssText="padding:6px;width:100px;height:100px;float:left;display:inline";var c=document.createElement("div");d&&(d.Map=a,d.Button=c);c.className="ui-state-default";c.style.cssText="position:absolute;width:100px;height:100px;font-size:8.5pt;font-weight:bold;cursor:pointer;border-radius: 5px 5px 5px 5px";if(d&&d.ImageUrl){var f=document.createElement("img");f.src=
d.ImageUrl;f.style.cssText="position:absolute;left:25px;top:16px";c.appendChild(f)}d&&d.OnClick?xMap.Dom.addClickListener(c,function(){d.OnClick();xMap.UI.ShowPane(b)}):d&&d.OnEvent&&xMap.Dom.addClickListener(c,function(){d.Map.SetActiveTool(d);xMap.UI.ShowPane(b)});d&&d.Text&&(f=document.createElement("div"),f.style.cssText="position:absolute;bottom:2px;left:2px",f.innerHTML=d.Text,c.appendChild(f));e.appendChild(c);b.appendChild(e);d.Type&&"button"!=d.Type&&a.AddTools([d])};
